/* jianyl 2017-6-6 */
var ysSearch = {
	eKeyword : 'ff-wd',
	downKey : 'searchMore',
	searchId: 'search_form',
	defaultWord : '',
	hideWord : '请输入搜索词',
	headKeyword : '余罪',
	data : '',
	canLoad : '',
	keyword : '余罪2',
	oAjax : '余罪3',
	delay : 200,
	timeout : '',
	sugCurrent : 0,
	suffix : 'sslx',
	init : function(){
		this.regEvent();
	},
	cache : {
		data : {},
		add : function(key, val){
			this.data[key] = val;
		},		
		get : function(key){
			return this.data[key] || '';
		}
	},
	regEvent : function(){
		var _self = this;
		_self.getDefaultWord();
		$('#' + _self.eKeyword).blur(function(){
			_self.keyword = this.value;
			if (_self.keyword == '') {
				$(this).val(_self.defaultWord);
			}
			setTimeout(function(){$('#headerSearch').removeClass('header_search_focus');}, 300);
		}).focus(function(){
			$('#headerSearch').addClass('header_search_focus');
			_self.keyword = this.value;
			if (_self.keyword == _self.defaultWord){
				$(this).val('');
				_self.keyword = '';
				_self.fnGetKeyWord();
			}
			_self.show();
		});
		$('#' + _self.eKeyword).keyup(function(event){
			_self.showKeyup(this.value, event);
		});
		$('#' + _self.searchId).click(function(){
			_self.searchForm();
		});

		$(document).click(function(event){
			var obj = event.srcElement ? event.srcElement : event.target;
			var id = obj.id;
			if(id != 'ff-wd') return _self.fnHideKeyWord();
		});
	},


	getDefaultWord : function(){
		var _self = this;
		var newData = new Date().getTime();
		var ctime = parseInt(newData / 1000);

	},
	headMore : function(){
		$('#headMore').click(function(){
			if($(this).hasClass('userSelectListHover')){
				$(this).removeClass('userSelectListHover');
			}
			else{
				$(this).addClass('userSelectListHover');
			}
		});
		$('#headMore').mouseover(function(){
			$(this).addClass('userSelectListHover');
		}).mouseout(function(){
			$(this).removeClass('userSelectListHover');
		});
	},
	fnGetKeyWord : function(){
		var _self = this;		
		var kwhtml ='';

		kwhtml += "";
		$("#" + _self.downKey).html(kwhtml);
		if(_self.headKeyword != ''){
			$("#" + _self.downKey).show();
		}
	},
	fnHideKeyWord : function(){
		$("#" + this.downKey).html('');
		$("#" + this.downKey).hide();
	},
	putKey : function(val){
		$('#' + this.eKeyword).val(val);
		this.fnHideKeyWord();
	},
	showKeyup : function(val, e){
		var _self = this;
		_self.keyword = val;
		if(_self.keyword == ''){
			_self.fnGetKeyWord();
		}
		else{
			var key = window.event ? e.keyCode : e.which;
			if(key != 38 && key != 40){   
				_self.fnHideKeyWord(); 
				if(_self.keyword != _self.hideWord && key == 13){
					_self.searchForm();
					return false;
				}
			}  
		}
		_self.doKeyup();
	},
	doKeyup : function(){
		var _self = this;
		if (_self.timeout) clearTimeout(_self.timeout);
		$(document).bind('keyup', function(event){
			if (event.which > 111 && event.which < 138) return; //F1~F12
			if (event.which == 37 || event.which == 39) return; //LEFT~RIGHT
			if (event.which == 27) return _self.fnHideKeyWord(); //ESC
		});
		_self.timeout = setTimeout(function(){_self.show();}, this.delay)
	},

	parseList : function(){
		var _self = this;
		var html = '<div class="search_more_con"><ul class="search_data_list clearfix">';
		$.each(_self.data, function(i, v){
			if(typeof v == 'object'){
				var xqurl = v.xqurl ? v.xqurl : 'http://v.km.com/so_' + v.title + '/';
				var title = v.showTitle;
				if(v.ctype == 'mx'){
					title = v.title;
				}
				title = title.substr(0, 16);
				if(i == 0 && this.ctype != 'mx'){
					var actorName = '主演';
					if(this.ctype == 'zy'){
						actorName = '主持人';
					}
					html += '<li class="li_first"><div class="v_pic"><img src="' + this.img + '" onerror="javascript:this.src=\'' + this.noimg + '\'"></div><div class="v_txt"><span class="s_tit">' + _self.hiLight(title, _self.keyword) + '[' + this.cntype + ']</span>';
					if(this.ctype != 'zy' && this.year != 0){
						html += '<span class="s_des">年代：' + this.year + '</span>';
					}
					if(this.region){
						html += '<span class="s_des">地区：';
						$.each(this.region, function(k,n){
							html += '<em>' + n + '</em>';
						});
						html += '</span>';
					}
					if(this.type){
						html += '<span class="s_des">类型：';
						$.each(this.type, function(k,n){
							html += '<em>' + n + '</em>';
						});
						html += '</span>';
					}
					if(this.station){
						html += '<span class="s_des">播出：' + this.station + '</span>';
					}
					if(this.actor){
						html += '<span class="s_des">' + actorName + '：';
						$.each(this.actor, function(k,n){
							html += '<em>' + n + '</em>';
						});
						html += '</span>';
					}
					html += '<span class="s_des"></span></div><i class="iconfont i_play">&#xe621;</i><a href="' + xqurl + '" target="_blank" class="a_mask" title="' + this.title + '"></a></li>';
				}else{
					html += '<li><a href="' + xqurl + '" target="_blank" title="' + this.title + '">' + _self.hiLight(title, _self.keyword) + '[' + this.cntype + ']</a></li>';
				}
			}
		});
		html += '</ul></div>';
		return html;
	},
	hiLight : function(str, tostr){
		return str.replace(tostr, '<strong>' + tostr + '</strong>');
	}
};
$(function(){
	ysSearch.init();
});