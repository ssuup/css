var inputTrackle={textId:"",defaultContent:[],wordLimits:[],grayColor:"#aaa",blackColor:"#333",addtionalEvent:[],init:function(textId,defaultContent,wordLimits,addtionalEvent){this.textId=textId;this.defaultContent[textId]=defaultContent;this.wordLimits[textId]=wordLimits||this.wordLimits;this.addtionalEvent[textId]=addtionalEvent;this.regEvent()},regEvent:function(){var _self=this;_self.setDefaultContent(_self.textId);$("#"+_self.textId).focus(function(){if(_self.getContent(this)==_self.defaultContent[this.id]){$(this).val("").css({"color":_self.blackColor})}if(typeof _self.addtionalEvent[this.id]!="undefined"&&typeof _self.addtionalEvent[this.id].focus!="undefined"){_self.addtionalEvent[this.id].focus()}}).blur(function(){if(!_self.getContent(this)){_self.setDefaultContent(this.id)}if(typeof _self.addtionalEvent[this.id]!="undefined"&&typeof _self.addtionalEvent[this.id].blur!="undefined"){_self.addtionalEvent[this.id].blur()}}).keyup(function(){var fillContent=_self.getContent(this);if(fillContent&&_self.wordLimits[this.id]){if(fillContent.length>=_self.wordLimits[this.id]){$(this).val(fillContent.substr(0,_self.wordLimits[this.id]))}}if(typeof _self.addtionalEvent[this.id]!="undefined"&&typeof _self.addtionalEvent[this.id].keyup!="undefined"){_self.addtionalEvent[this.id].keyup()}})},getContent:function(textId){return $(textId).val()},setDefaultContent:function(textId){$("#"+textId).val(this.defaultContent[textId]).css({"color":this.grayColor})}};var commentCaptcha={captchaUrl:"http://DOMAIN/moviecore/server/common/randCaptcha.php",ajaxNewUrl:"http://DOMAIN/moviecore/server/mversion/index.php?ctl=comment&act=checkCode",captchaId:"captchaInput",captImgId:"captImgId",defualtCaptcha:"点此输入验证码",wordLimits:4,alreadyShow:0,init:function(){this.setRelValue();this.regEvent(this.captchaId)},setRelValue:function(){var domain=location.host;this.captchaUrl=this.captchaUrl.replace(/DOMAIN/,domain);this.ajaxNewUrl=this.ajaxNewUrl.replace(/DOMAIN/,domain)},regEvent:function(captchaId){var addtionalEvent={"focus":this.showCaptcha,"blur":this.checkBurCaptcha,"keyup":this.checkKeyCaptcha};inputTrackle.init(captchaId,this.defualtCaptcha,this.wordLimits,addtionalEvent);$("#"+this.captchaId).show()},showCaptcha:function(){var _self=commentCaptcha;if(!_self.alreadyShow){_self.refreshCaptcha();$("#"+_self.captImgId+" a").eq(0).bind("click",_self.refreshCaptcha);$("#"+_self.captImgId).show();_self.alreadyShow=1}var fillCaptcha=inputTrackle.getContent($("#"+_self.captchaId));if(fillCaptcha.length<_self.wordLimits){$("#"+_self.captchaId).siblings(".iconfont").css({"display":"none"})}},refreshCaptcha:function(){var _self=commentCaptcha;$("#"+_self.captImgId+" img").eq(0).attr("src",_self.captchaUrl+"?"+(new Date()).getTime());if(document.all){return false}},checkKeyCaptcha:function(){var _self=commentCaptcha;var fillCaptcha=inputTrackle.getContent($("#"+_self.captchaId));if(fillCaptcha==_self.defualtCaptcha){return}if(fillCaptcha.length==_self.wordLimits){$.ajax({url:_self.ajaxNewUrl,type:"POST",data:"pImgCode="+fillCaptcha,success:function(e){e=eval("("+e+")");if(e.notice=="success"){$("#"+_self.captchaId).siblings(".iconfont").css({"display":"none"}).siblings(".iIconRight").css({"display":"block"})}else{$("#"+_self.captchaId).siblings(".iconfont").css({"display":"none"}).siblings(".iIconError").css({"display":"block"})}}})}},checkBurCaptcha:function(){var _self=commentCaptcha;var fillCaptcha=inputTrackle.getContent($("#"+_self.captchaId));if(fillCaptcha==_self.defualtCaptcha){return}if(fillCaptcha.length!=_self.wordLimits){$("#"+_self.captchaId).siblings(".iconfont").css({"display":"none"}).siblings(".iIconError").css({"display":"block"})}else{$.ajax({url:_self.ajaxNewUrl,type:"POST",data:"pImgCode="+fillCaptcha,success:function(e){e=eval("("+e+")");if(e.notice=="success"){$("#"+_self.captchaId).siblings(".iconfont").css({"display":"none"}).siblings(".iIconRight").css({"display":"block"})}else{$("#"+_self.captchaId).siblings(".iconfont").css({"display":"none"}).siblings(".iIconError").css({"display":"block"})}}})}}};var comment={submitUrl:"http://DOMAIN/moviecore/server/mversion/index.php?ctl=comment&act=addPcComment",defaultContent:"",commentText:"commentTextarea",commentSubmit:"commentSubmit",wordLimits:300,content:"",replyName:"aReply",replyId:"blueBtn",replyTextId:"textareaFocus",replyObj:"",replyNum:0,replyHtml:'<div class="replyForm" id="replyCon"><div class="v_pic"><img src="http://img1.km.com/dianyingimg/mversion/comment/images/user/1.png"></div><div class="replyTextArea"><div class="textareaCon"><textarea id="textareaFocus" placeholder="我来说一说"></textarea></div></div><p class="pReplyFun"><a href="javascript:void(0);" target="_self" class="v_yellow_btn replyBtn" id="blueBtn">&nbsp;&nbsp;回&nbsp;复&nbsp;&nbsp;</a></p></div>',tid:0,pid:0,toUid:0,init:function(){this.setRelValue();this.regEvent(this.commentText,this.commentSubmit,this.replyName)},setRelValue:function(){var domain=location.host;this.submitUrl=this.submitUrl.replace(/DOMAIN/,domain);
this.defaultContent="《"+pageConfig.mediaTitle+"》怎么样？写出你的想法"},regEvent:function(textId,submitId,replyName){var _self=this;inputTrackle.init(textId,_self.defaultContent,_self.wordLimits);$("#"+submitId).click(function(){_self.submitComment()});$("."+replyName).each(function(){$(this).click(function(){_self.showReply(this)})})},checkContent:function(){var _self=this;_self.content=$("#"+_self.commentText).val();var img=$("#"+commentCaptcha.captchaId).val();if(_self.content==""||_self.content.replace(/^\s+|\s+$/g,"")==""||_self.content.replace(/^\s+|\s+$/g,"")==_self.defaultContent){alert("请输入内容后再提交哦~");return false}if(/^([0-9a-zA-Z \r\n]+)$/.test(_self.content)){alert("一连串纯数字或纯字母是不能提交的哦");return false}if(_self.content.indexOf(".cc")!=-1||_self.content.indexOf(".net")!=-1||_self.content.indexOf("http://")!=-1||_self.content.indexOf(".com")!=-1||_self.content.indexOf(".cn")!=-1||_self.content.indexOf("www")!=-1){alert("链接不能提交的哦");return false}if(img.replace(/^\s+|\s+$/g,"")==""||img.replace(/^\s+|\s+$/g,"")==commentCaptcha.defualtCaptcha){if($("#"+commentCaptcha.captchaId).css("display")=="none"){$("#"+commentCaptcha.captchaId).show()}$("#errorCode").html("请输入验证码");setTimeout("$('#errorCode').html('');",3050);return false}return true},submitComment:function(){var _self=this;if(!_self.checkContent()){return false}var uid=0,uName="我";$.ajax({url:_self.submitUrl+"&type=comment",type:"post",data:{id:pageConfig.mediaId,channel:pageConfig.mediaType,content:_self.content,idData:{tid:uid,pid:uid,toUid:uid,uid:uid},pImgCode:$("#"+commentCaptcha.captchaId).val()},success:function(e){e=eval("("+e+")");if(e.status==200){$("#comment_li").prepend("<li><div class='v_pic'><img src='http://img1.km.com/dianyingimg/mversion/comment/images/user/1.png'></div><div class='v_txt'><p class='pTit'><span class='sName'>我</span><span class='sTime'>刚刚</span><span class='sCheck' id='showSuccess'>发表成功，待小编审核！</span></p><p class='pTxt'>"+_self.content+"</p></div></li>");$(window).scrollTop($("#comment").offset().top);setTimeout("$('#showSuccess').remove();",5050);inputTrackle.init(_self.commentText,_self.defaultContent,_self.wordLimits)}else{if(e.notice=="vic"){$("#errorCode").html("验证码错误");setTimeout("$('#errorCode').html('');",3050)}else{alert(e.notice)}}commentCaptcha.init();commentCaptcha.refreshCaptcha();$("#"+commentCaptcha.captchaId).siblings(".iconfont").css({"display":"none"})}})},showReply:function(obj){var _self=this;_self.pid=$(obj).attr("pid");_self.tid=$(obj).attr("tid");if(_self.replyObj!=""&&_self.replyNum>0&&_self.replyObj==obj){if($("#replyCon").css("display")=="none"){$("#replyCon").css("display","block")}else{$("#replyCon").css("display","none")}if(_self.pid==0){_self.showSub(_self.tid)}}else{if(_self.replyNum>0){$("#replyCon").remove();_self.replyNum=0;var replyTid=$(_self.replyObj).attr("tid")}_self.toUid=$(obj).attr("uid");if($("#commentReply_"+_self.tid)[0]){if(_self.pid==0){$("#commentReply_"+_self.tid).prepend(_self.replyHtml);_self.showSub(_self.tid)}else{$("#replyLi_"+_self.pid).append(_self.replyHtml)}}else{$("#comment_"+_self.tid).prepend('<div class="replyCon">'+_self.replyHtml+"</div>");$("#comment_"+_self.tid).show()}_self.replyObj=obj;_self.replyNum=1;$("#"+_self.replyId).click(function(){_self.submitReply(obj)})}$(".replyTextArea textarea").flexText()},showSub:function(id){if($("#showReply_"+id)[0]){if($("#showReply_"+id).css("display")=="none"){$("#showReply_"+id).show();if($("#replyCon").css("display")=="none"){$("#replyCon").css("display","block")}}else{$("#showReply_"+id).hide()}}var _self=this;if($("#showMore_"+id)[0]){$("#showMore_"+id).click(function(){_self.showMore(id)})}},submitReply:function(obj){var _self=this;if(!_self.checkReply()){return false}var uid=0,uName="游客";$.ajax({url:_self.submitUrl,type:"post",data:{id:pageConfig.mediaId,channel:pageConfig.mediaType,content:_self.content,idData:{tid:_self.tid,pid:_self.pid,toUid:_self.toUid,uid:uid}},success:function(e){e=eval("("+e+")");if(e.status==200){var html="<li><div class='v_pic'><img src='http://img1.km.com/dianyingimg/mversion/comment/images/user/1.png'></div><div class='v_txt'><p class='pTit'><span class='sName'>我</span><span class='sTime'>刚刚</span><span class='sCheck' id='showSuccess'>发表成功，待小编审核！</span></p><p class='pTxt'>"+_self.content+"</p></div></li>";if($("#commentUl_"+_self.tid)[0]){$("#commentUl_"+_self.tid).prepend(html)}else{$("#comment_"+_self.tid).prepend("<div class='replyCon'><ul class='clearfix'>"+html+"</ul></div>");$("#comment_"+_self.tid).show()}setTimeout("$('#showSuccess').remove();",5050);inputTrackle.init(_self.commentText,_self.defaultContent,_self.wordLimits)}else{alert(e.notice)}$("#replyCon").remove();_self.replyNum=0}})},checkReply:function(){var _self=this;_self.content=$("#"+_self.replyTextId).val();if(_self.content==""||_self.content.replace(/^\s+|\s+$/g,"")==""){alert("请输入内容后再提交哦~");return false}if(/^([0-9a-zA-Z \r\n]+)$/.test(_self.content)){alert("一连串纯数字或纯字母是不能提交的哦");return false}if(_self.content.indexOf(".cc")!=-1||_self.content.indexOf(".net")!=-1||_self.content.indexOf("http://")!=-1||_self.content.indexOf(".com")!=-1||_self.content.indexOf(".cn")!=-1||_self.content.indexOf("www")!=-1){alert("链接不能提交的哦");
return false}return true},showMore:function(id){var _self=this;$("#commentUl_"+id+" li").each(function(){if($(this).attr("class")=="hide"){$(this).css("display","block")}});$("#showMore_"+id).css("display","none");if($("#hideMore_"+id)[0]){$("#hideMore_"+id).css("display","block");$("#hideMore_"+id).click(function(){_self.hideMore(id)})}},hideMore:function(id){var _self=this;$("#commentUl_"+id+" li").each(function(){if($(this).attr("class")=="hide"){$(this).css("display","none")}});$("#hideMore_"+id).css("display","none");if($("#showMore_"+id)[0]){$("#showMore_"+id).css("display","block");$("#showMore_"+id).click(function(){_self.showMore(id)})}}};var comments={commentUrl:"http://v.km.com/moviecore/server/comment/index.php",page:1,init:function(){var _self=this;if($("#pageComment")[0]){$(".ajaxComment").each(function(){$(this).click(function(){_self.getAjaxComments(this)})})}},getAjaxComments:function(obj){var oldPage=this.page;this.page=$(obj).attr("page");if(this.page==oldPage){return false}var _self=this;$.getJSON(_self.commentUrl+"?id="+pageConfig.mediaId+"&media="+pageConfig.commentMedia+"&act=getNewComments&jqueryCallback=?&page="+_self.page+"&"+new Date().getTime(),function(json){if(json.status=="success"){$("#comment_li").html(json.html);$("#pageComment").html(json.pageStr);_self.init();comment.init()}})}};if(typeof pageConfig.pageType!="undefined"&&pageConfig.pageType=="comment"){comments.init()}comment.init();commentCaptcha.init();